<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Å‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡∏ó‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</title>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Mali', cursive;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); /* ‡∏™‡∏µ‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏• ‡∏°‡∏¥‡πâ‡∏ô‡∏ó‡πå-‡∏ä‡∏°‡∏û‡∏π */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        .container {
            background-color: rgba(255, 255, 255, 0.95);
            padding: 2.5rem;
            border-radius: 30px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 450px;
            max-width: 90%;
            border: 5px solid #fff;
            position: relative;
        }

        h1 { color: #555; margin-bottom: 5px; }
        
        /* ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå (‡∏Ñ‡∏≥‡πÉ‡∏ö‡πâ) */
        .puzzle-box {
            background: #fdfbf7;
            border: 3px dashed #ff9a9e;
            border-radius: 20px;
            padding: 20px;
            margin: 20px 0;
            min-height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .puzzle-word {
            font-size: 2.5rem;
            font-weight: bold;
            color: #4a4a4a;
            letter-spacing: 5px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ */
            text-shadow: 2px 2px 0 #eee;
        }

        /* Input */
        input[type="text"] {
            width: 100%;
            padding: 15px;
            font-size: 1.6rem;
            font-family: 'Mali', cursive;
            text-align: center;
            border: 3px solid #ddd;
            border-radius: 50px;
            box-sizing: border-box;
            margin-bottom: 20px;
            background-color: #fafafa;
            outline: none;
            transition: 0.3s;
            color: #333;
        }
        input:focus { 
            border-color: #a8edea; 
            background: #fff; 
            transform: scale(1.02); 
            box-shadow: 0 0 15px rgba(168, 237, 234, 0.5);
        }

        /* Buttons */
        .btn {
            background: linear-gradient(to right, #ff9a9e 0%, #fecfef 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.3rem;
            font-family: 'Mali', cursive;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            transition: transform 0.2s;
            box-shadow: 0 5px 15px rgba(255, 154, 158, 0.4);
        }
        .btn:hover { transform: translateY(-3px); }

        /* Stats */
        .stats {
            display: flex;
            justify-content: space-between;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        .timer-box { color: #ff6b6b; position: relative; }
        .score-box { color: #2ecc71; }

        /* Screen Management */
        .screen { display: none; }
        .active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* Leaderboard */
        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .leaderboard-table th { background-color: #a8edea; color: #555; padding: 10px; border-radius: 10px 10px 0 0; }
        .leaderboard-table td { border-bottom: 1px solid #eee; padding: 8px; color: #666; }
        .rank-1 { color: #f1c40f; font-weight: bold; }

        /* Effects */
        @keyframes popText { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }
        .floating-feedback {
            position: absolute; top: 40%; left: 50%; transform: translate(-50%, -50%);
            font-size: 2rem; font-weight: bold; color: #ff9a9e;
            text-shadow: 2px 2px 0 #fff; pointer-events: none;
            animation: floatUp 1s ease-out forwards;
        }
        @keyframes floatUp { 0% { opacity: 1; transform: translate(-50%, 0); } 100% { opacity: 0; transform: translate(-50%, -80px); } }

        .time-bonus {
            position: absolute; top: -30px; right: 0; left: 0;
            color: #2ecc71; font-size: 1.2rem; font-weight: bold;
            animation: floatUp 0.8s ease-out forwards;
        }
    </style>
</head>
<body>

    <div class="container">
        <div id="start-screen" class="screen active">
            <h1>‡∏õ‡∏£‡∏¥‡∏®‡∏ô‡∏≤‡∏Ñ‡∏≥‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î üß©</h1>
            <p>‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏≥‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</p>
            <p style="color:#e74c3c; font-size: 0.9rem;">(‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î = ‡∏à‡∏ö‡πÄ‡∏Å‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ)</p>
            <input type="text" id="player-name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì..." maxlength="10">
            <button class="btn" onclick="goToGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°!</button>
        </div>

        <div id="game-screen" class="screen">
            <div class="stats">
                <span class="timer-box" id="timer-container">‚è≥ <span id="time-left">60</span>s</span>
                <span class="score-box">‚≠ê <span id="score">0</span></span>
            </div>
            
            <div class="puzzle-box">
                <div id="puzzle-text" class="puzzle-word">_ _ _ _ _</div>
            </div>
            
            <input type="text" id="answer-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏ï‡πá‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." autocomplete="off">
            <p style="font-size: 0.8rem; color: #aaa;">‡∏Å‡∏î Enter ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</p>
        </div>

        <div id="end-screen" class="screen">
            <h2 id="end-title">‡∏à‡∏ö‡πÄ‡∏Å‡∏°!</h2>
            <p>‡πÄ‡∏â‡∏•‡∏¢: <span id="correct-answer-show" style="color:#2ecc71; font-weight:bold; font-size: 1.5rem;">-</span></p>
            <p>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span id="final-score" style="font-size: 2.5rem; color: #ff9a9e; font-weight: bold;">0</span></p>
            
            <div style="background: #fff; border-radius: 15px; padding: 10px; margin-top:10px; box-shadow: 0 5px 10px rgba(0,0,0,0.05);">
                <h3 style="margin:5px;">üèÜ ‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</h3>
                <table class="leaderboard-table">
                    <thead><tr><th>#</th><th>‡∏ä‡∏∑‡πà‡∏≠</th><th>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</th></tr></thead>
                    <tbody id="leaderboard-body"></tbody>
                </table>
            </div>

            <button class="btn" onclick="restartGame()" style="margin-top: 20px;">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á üîÑ</button>
        </div>
    </div>

    <script>
        // ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ 77 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
        const allProvinces = [
            "‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£", "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó",
            "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", "‡∏ä‡∏∏‡∏°‡∏û‡∏£", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", "‡∏ï‡∏£‡∏±‡∏á", "‡∏ï‡∏£‡∏≤‡∏î", "‡∏ï‡∏≤‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°",
            "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", "‡∏ô‡πà‡∏≤‡∏ô", "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå",
            "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", "‡∏û‡∏±‡∏á‡∏á‡∏≤", "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå",
            "‡πÅ‡∏û‡∏£‡πà", "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", "‡∏¢‡∏∞‡∏•‡∏≤", "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", "‡∏£‡∏∞‡∏¢‡∏≠‡∏á",
            "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", "‡∏•‡∏≥‡∏û‡∏π‡∏ô", "‡πÄ‡∏•‡∏¢", "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", "‡∏™‡∏ï‡∏π‡∏•", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£",
            "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢",
            "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ"
        ];

        let score = 0;
        let time = 60;
        let isPlaying = false;
        let currentProvince = "";
        let timerInterval;
        let playerName = "";

        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const nameInput = document.getElementById('player-name');
        const timeDisplay = document.getElementById('time-left');
        const scoreDisplay = document.getElementById('score');
        const puzzleText = document.getElementById('puzzle-text');
        const inputField = document.getElementById('answer-input');
        const timerContainer = document.getElementById('timer-container');
        const correctAnswerShow = document.getElementById('correct-answer-show');

        // Load saved name
        if(localStorage.getItem('lastPlayerNamePuzzle')) {
            nameInput.value = localStorage.getItem('lastPlayerNamePuzzle');
        }

        function goToGame() {
            playerName = nameInput.value.trim();
            if (!playerName) { alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"); return; }
            localStorage.setItem('lastPlayerNamePuzzle', playerName);
            
            startScreen.classList.remove('active');
            gameScreen.classList.add('active');
            startGame();
        }

        function startGame() {
            score = 0;
            time = 60;
            isPlaying = true;
            scoreDisplay.innerText = score;
            timeDisplay.innerText = time;
            inputField.value = '';
            inputField.focus();

            generatePuzzle();

            timerInterval = setInterval(() => {
                time--;
                timeDisplay.innerText = time;
                if (time <= 0) endGame('time');
            }, 1000);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏à‡∏ó‡∏¢‡πå (Masking)
        function generatePuzzle() {
            // ‡∏™‡∏∏‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î
            currentProvince = allProvinces[Math.floor(Math.random() * allProvinces.length)];
            
            // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô Array ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£
            let chars = currentProvince.split('');
            let hiddenCount = 0;
            
            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 50%
            for (let i = 0; i < chars.length; i++) {
                // ‡πÑ‡∏°‡πà‡∏ã‡πà‡∏≠‡∏ô‡∏™‡∏£‡∏∞‡∏ö‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô/‡∏•‡πà‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏° (‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÜ)
                // ‡∏´‡∏£‡∏∑‡∏≠‡∏ã‡πà‡∏≠‡∏ô‡πÅ‡∏ö‡∏ö‡∏™‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏¢
                if (Math.random() > 0.4 && chars[i] !== ' ') {
                    chars[i] = '_';
                    hiddenCount++;
                }
            }

            // ‡∏ñ‡πâ‡∏≤‡∏ã‡πà‡∏≠‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÑ‡∏õ (‡πÄ‡∏ä‡πà‡∏ô ‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏±‡πâ‡∏ô‡πÜ) ‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡∏ß‡πÅ‡∏£‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°
            if (hiddenCount === 0) chars[0] = '_';

            // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÅ‡∏ö‡∏ö‡∏°‡∏µ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢
            puzzleText.innerText = chars.join(' ');
        }

        function checkAnswer() {
            let userAnswer = inputField.value.trim();
            
            if (userAnswer === currentProvince) {
                // ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å
                score++;
                time += 3; // ‡∏ö‡∏ß‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                scoreDisplay.innerText = score;
                timeDisplay.innerText = time;
                
                showFeedback("‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! üéâ");
                showTimeBonus();
                
                inputField.value = '';
                generatePuzzle();
            } else {
                // ‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î
                endGame('wrong');
            }
        }

        function endGame(reason) {
            clearInterval(timerInterval);
            isPlaying = false;
            
            gameScreen.classList.remove('active');
            endScreen.classList.add('active');
            
            document.getElementById('final-score').innerText = score;
            correctAnswerShow.innerText = currentProvince; // ‡πÄ‡∏â‡∏•‡∏¢

            const endTitle = document.getElementById('end-title');
            if (reason === 'wrong') {
                endTitle.innerHTML = "<span style='color:#e74c3c'>‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î‡∏à‡πâ‡∏≤! ‚ùå</span>";
            } else {
                endTitle.innerHTML = "<span style='color:#f39c12'>‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤! ‚è∞</span>";
            }

            saveScore(playerName, score);
            showLeaderboard();
        }

        function restartGame() {
            endScreen.classList.remove('active');
            startScreen.classList.add('active');
        }

        // --- Effects ---
        function showFeedback(text) {
            const el = document.createElement('div');
            el.className = 'floating-feedback';
            el.innerText = text;
            gameScreen.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function showTimeBonus() {
            const el = document.createElement('div');
            el.className = 'time-bonus';
            el.innerText = '+3s';
            timerContainer.appendChild(el);
            setTimeout(() => el.remove(), 800);
        }

        // --- Leaderboard ---
        function saveScore(name, score) {
            let scores = JSON.parse(localStorage.getItem('puzzleGameScores')) || [];
            scores.push({ name: name, score: score });
            scores.sort((a, b) => b.score - a.score);
            scores = scores.slice(0, 5);
            localStorage.setItem('puzzleGameScores', JSON.stringify(scores));
        }

        function showLeaderboard() {
            let scores = JSON.parse(localStorage.getItem('puzzleGameScores')) || [];
            const tbody = document.getElementById('leaderboard-body');
            tbody.innerHTML = '';

            scores.forEach((player, index) => {
                const row = document.createElement('tr');
                if(index === 0) row.classList.add('rank-1');
                row.innerHTML = `<td>${index+1}</td><td>${player.name}</td><td>${player.score}</td>`;
                tbody.appendChild(row);
            });
            
            if(scores.length === 0) tbody.innerHTML = '<tr><td colspan="3">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</td></tr>';
        }

        // Input Listener
        inputField.addEventListener('keyup', (e) => {
            if (!isPlaying) return;
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });
    </script>
</body>
</html>
